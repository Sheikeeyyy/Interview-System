{% extends "base.html" %}
{% block content %}
<h3>Evaluate Candidate</h3>

<form method="POST" action="/evaluate/save/{{ submission.id }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

{% for i in range(questions|length) %}
<div class="card mb-4 shadow-sm">
    <div class="card-body">

        <h5>Q{{ i+1 }}. {{ questions[i].question }}</h5>

        {% if audio_map.get(i|string) %}
    <audio controls class="w-100 mt-2" preload="metadata">
        <source
            src="{{ url_for('admin_audio', filename=audio_map[i|string]) }}"
            type="audio/wav"
        >
        Your browser does not support audio playback.
    </audio>
{% endif %}


<p class="mt-3"><strong>Transcript:</strong></p>

<div class="alert alert-light border">
  {% if submission.exam_type == "webcam" %}
      {{ webcam_rows[i].transcript if webcam_rows[i].transcript else "No transcript available" }}
  {% else %}
      {{ answers[i|string] }}
  {% endif %}
</div>


        <p class="text-muted">
            AI Score: {{ feedback[i|string].score }} / 5  
            <br>
            Reason: {{ feedback[i|string].reason }}
        </p>

        <label>Final Marks (0â€“5)</label>
        <input type="number"
               name="{{ i }}"
               value="{{ feedback[i|string].score }}"
               min="0" max="5"
               class="form-control"
               required>

    </div>
</div>
{% endfor %}

<button class="btn btn-success btn-lg">Save Final Evaluation</button>
</form>
{% if webcam_rows %}
<hr>
<h4>Webcam Answers (Admin Only)</h4>

{% for row in webcam_rows %}
<div class="card mb-3 shadow-sm">
  <div class="card-body">

    <h6>Question {{ row.question_index + 1 }}</h6>
    <p class="text-muted">{{ row.question_text }}</p>

    <video width="420" controls preload="metadata">

      <source src="{{ url_for('admin_video', filename=row.video_file) }}"
              type="video/webm">
    </video>
    <p class="mt-2"><strong>Transcript:</strong></p>
<div class="alert alert-light border">
  {{ row.transcript or "No transcript available" }}
</div>


    <div class="text-muted mt-2">
      Recorded at: {{ row.created_at }}
    </div>

  </div>
</div>
{% endfor %}

{% endif %}


{% endblock %}
